{% extends "base.html" %} {% block title %}Login{% endblock %} {% block navbar
%}{% endblock %} {% block body %}

<div class="login-page-container">
  <div class="login-container">
    <div class="login-side-image">
      <img src="/static/images/user_icon.svg" alt="Helpouts logo" />
    </div>

    <div class="login-form-card">
      <div class="login-card-content">
        <div class="header mb-4">
          <div class="text-center">
            <img src="/static/images/templogo6.png" alt="Helpouts logo" class="login-logo" />
          </div>
          <h2 class="text-center" style="color: #3d6978; font-weight: bold">
            Welcome Back
          </h2>
          <p class="text-muted text-center" style="display: block" id="details">
            Enter your details to stay connected.
          </p>
        </div>

        <form action="/login" method="POST">
          <div id="login-step-1">
            <div class="mb-3 mt-3">
              <div class="form-group mb-4">
                {% if error%}
                <p class="error">{{ error }}</p>
                {% endif %}
                <span class="label-muted">EMAIL<span style="color: #d57a44">*</span></span>
                <input id="email" type="email" name="email" aria-label="Email" class="form-control soft-input"
                  placeholder="e.g., janedoe@email.com" autocomplete="off" required />
              </div>
              <div class="form-group mt-4 mb-4">
                <span class="label-muted">PASSWORD<span style="color: #d57a44">*</span></span>
                <input id="password" name="password" type="password" aria-label="Password"
                  class="form-control soft-input" autocomplete="off" placeholder="Min. 10 characters" required>
              </div>

              <button type="button" class="btn btn-link ms-auto" onclick="nextLoginStep()" id="login-next-btn"
                style="display: inline-block">
                <img src="/static/images/arrow-right.svg" width="40" height="40" />
              </button>
              <p class="text-muted mt-4 text-center">
                Don't have an account? <a href="/register_page/">Sign Up</a>
              </p>
            </div>
          </div>
          <div id="login-step-2" style="display: none">
              <div class="mb-3 mt-3">
                <div class="form-group mt-4 mb-4">
                  <span class="label-muted">MFA Code<span style="color: #d57a44">*</span></span>
                  <input id="mfa" name="mfa" type="text" aria-label="MFA" class="form-control soft-input"
                    autocomplete="off" required>
                    <div class="d-flex gap-2 mt-4 mb-4"></div>
                  <button id="login-btn" class="login-btn" type="submit" style="display: none">Sign In</button>
                </div>
              </div>
            </div>
        </form>
      </div>
    </div>

  </div>
</div>
<script>
  const emailInput = document.getElementsByName("email")[0]
  function nextLoginStep() {
    fetch("/MFA", {
      headers: {
        "Content-Type": "application/json",
      },
      method: "POST",
      body: JSON.stringify({
        email: emailInput.value
      }),
    })
      .then(response => response.json())
      .then(data => {
        if (data.status === "pending" || data.status === "sent") {
          document.getElementById("details").style.display = "none"
          document.getElementById("login-step-1").style.display = "none"
          document.getElementById("login-step-2").style.display = "block"
          document.getElementById("login-next-btn").style.display = "none"
          document.getElementById("login-btn").style.display = "block"
        } else {
          alert("Error sending SMS. Please try again.");
        }
      });

  }

</script>

{% endblock %}